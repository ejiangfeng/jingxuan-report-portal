# 鲸选自助报表平台产品手册

## 文档信息

| 项目 | 说明 |
|------|------|
| **产品名称** | 鲸选自助报表平台 |
| **版本号** | v2.0 |
| **最后更新** | 2026 年 2 月 27 日 |
| **适用部门** | 鲸选运营部、数据分析部 |
| **部署环境** | Docker 容器化部署 |

---

## 目录

1. [产品概述](#1-产品概述)
2. [核心功能](#2-核心功能)
3. [报表功能详解](#3-报表功能详解)
4. [使用指南](#4-使用指南)
5. [技术架构](#5-技术架构)
6. [系统配置](#6-系统配置)
7. [常见问题](#7-常见问题)
8. [版本历史](#8-版本历史)

---

## 1. 产品概述

### 1.1 产品定位

鲸选自助报表平台是专为鲸选部门打造的企业级数据查询与分析系统，支持运营人员自助查询订单数据、商品销售数据、营销活动数据等业务信息，并提供强大的数据导出功能。

### 1.2 核心价值

- ✅ **自助查询**：运营人员无需技术人员协助，自主完成数据查询
- ✅ **十万级性能**：支持十万级数据量的快速查询和导出
- ✅ **多维度筛选**：灵活的筛选条件，满足各种业务场景
- ✅ **安全可控**：数据只读访问，保障数据库安全
- ✅ **易于部署**：Docker 容器化，一键部署

### 1.3 访问地址

| 环境 | 地址 | 端口 |
|------|------|------|
| 生产环境 | http://localhost:7788 | 7788 |
| 开发环境 | http://localhost:7789 | 7789 |

---

## 2. 核心功能

### 2.1 报表查询

- **8 大业务报表**：覆盖订单、商品、营销、用户等核心业务
- **灵活筛选**：日期范围、门店、商品、状态等多维度筛选
- **分页展示**：支持自定义每页数量，默认 20 条/页
- **实时统计**：显示查询结果总数和执行时间

### 2.2 数据导出

- **Excel 导出**：支持.xlsx 格式，保持数据格式
- **异步处理**：导出任务后台处理，不阻塞页面
- **任务管理**：查看导出历史，重复下载
- **批量导出**：支持单次导出最多 50,000 条记录

### 2.3 智能特性

- **快捷日期**：提供"今日"、"昨日"、"近 7 天"等快捷选项
- **批量输入**：支持逗号分隔的批量查询（如多个门店代码）
- **自动清洗**：自动处理中文逗号、空格等格式问题
- **缓存优化**：静态资源缓存，HTML 实时更新

---

## 3. 报表功能详解

### 3.1 订单查询报表 📋

**功能说明**：多维度订单数据查询，支持订单汇总和明细查看

**查询条件**：
- 开始日期、结束日期（必填）
- 订单状态（可选）：待付款、待发货、待收货、交易成功、交易失败
- 门店代码（可选）：支持多个，逗号分隔
- 订单号（可选）：支持多个，逗号分隔
- 商品编码（可选）
- 商品条码（可选）

**展示字段**：
- 订单号、下单时间、订单状态、门店
- 商品金额、优惠券、实付金额
- 支付方式、配送方式、收货信息

**导出内容**：
- 订单汇总：每个订单一行，包含支付明细
- 订单明细：每个商品一行，包含商品详情

---

### 3.2 商品渗透率报表 📊

**功能说明**：分析商品在门店的销售渗透情况，评估商品受欢迎程度

**查询条件**：
- 开始日期、结束日期（必填）
- 门店代码（可选）：支持多个，逗号分隔
- 商品条码（可选）：支持多个，逗号分隔
- 商品编码（可选）：支持多个，逗号分隔

**展示字段**：
- 大类编码、大类名称
- 商品编码、商品条码、商品名称、规格
- 购买数量、商品订单量、商品用户数
- 大类订单渗透率、大类用户渗透率
- 全局订单渗透率、全局用户渗透率

**核心指标**：
- **渗透率** = 购买该商品的用户数 / 总用户数 × 100%
- 帮助识别畅销商品和滞销商品

---

### 3.3 搜索关键词查询报表 🔍

**功能说明**：查询用户在平台的搜索行为数据，分析用户搜索偏好

**查询条件**：
- 开始日期、结束日期（必填）
- 搜索关键词（可选）：支持多个，逗号分隔

**展示字段**：
- 数据日期、访问 ID、访问时间
- 搜索关键词、搜索类型
- 商品 SPU ID、商品名称
- 站点编码、站点名称

**数据源**：阿里云 DataWorks/MaxCompute

**业务价值**：
- 了解用户搜索热点
- 优化商品推荐
- 发现潜在需求

---

### 3.4 优惠券领用核销报表 🎫

**功能说明**：查询优惠券的领用和核销记录，分析优惠券使用效果

**查询条件**：
- 领用开始日期、领用结束日期（选填一项）
- 核销开始日期、核销结束日期（选填一项）
- 优惠券 ID（可选）：支持多个，逗号分隔

**注意事项**：
⚠️ 领用日期和核销日期至少需要填写其中一项

**展示字段**：
- 用户手机号、优惠券 ID、优惠券名称
- 领券时间、生效时间、失效时间
- 订单编号、配送方式、下单时间
- 商品总金额、优惠总金额、实付金额
- 门店编码、门店名称

---

### 3.5 免运活动查询报表 🚚

**功能说明**：查询免运费活动的使用记录，分析活动成本

**查询条件**：
- 开始日期、结束日期（必填）

**展示字段**：
- 订单号、下单时间、门店信息
- 原运费金额、优惠运费金额
- 实付运费、活动名称

---

### 3.6 社群拉新报表 👥

**功能说明**：查询社群拉新活动的助力记录

**查询条件**：
- 开始日期、结束日期（必填）

**展示字段**：
- 用户手机号、助力时间
- 活动名称、助力状态

---

### 3.7 商城用户下单报表 🛒

**功能说明**：查询商城用户的下单行为

**查询条件**：
- 查询日期（必填）
- 手机号（可选）

**展示字段**：
- 手机号、最近下单时间
- 鲸选商城最近下单时间

---

### 3.8 助力活动查询报表 🤝

**功能说明**：查询各类助力活动的参与记录

**查询条件**：
- 开始日期、结束日期（必填）
- 活动 ID（可选）

**展示字段**：
- 用户信息、助力时间
- 活动信息、助力状态

---

## 4. 使用指南

### 4.1 快速入门

**步骤 1：访问系统**
```
打开浏览器，访问 http://localhost:7788/
```

**步骤 2：选择报表**
```
点击顶部导航栏，选择需要的报表类型
```

**步骤 3：设置筛选条件**
```
- 选择日期范围（必填）
- 输入其他筛选条件（可选）
- 点击"查询报表"按钮
```

**步骤 4：查看结果**
```
- 查看表格数据
- 使用分页浏览更多数据
- 点击"导出查询结果"导出数据
```

### 4.2 查询技巧

**技巧 1：批量查询**
```
门店代码输入：2625,1405,9976
搜索关键词输入：牛奶，车厘子，鸡蛋
（支持中文逗号和英文逗号）
```

**技巧 2：快捷日期**
```
部分报表提供快捷日期选项：
- 今天
- 昨天
- 近 7 天
- 近 30 天
- 本月
- 上月
```

**技巧 3：清空条件**
```
点击"重置查询条件"按钮，快速清空所有筛选
```

### 4.3 导出操作

**步骤 1：创建导出任务**
```
1. 设置查询条件
2. 点击"导出查询结果"
3. 系统提示任务已创建
```

**步骤 2：查看导出进度**
```
1. 点击"📋 导出任务"按钮
2. 查看任务状态（处理中/已完成/失败）
3. 等待任务完成
```

**步骤 3：下载文件**
```
1. 状态为"已完成"时，点击"⬇️ 下载"
2. 选择保存位置
3. 用 Excel 打开查看
```

**导出限制**：
- 单次导出最多 50,000 条记录
- 导出文件保留 1 天
- 支持.xlsx 格式

---

## 5. 技术架构

### 5.1 系统架构图

```
┌─────────────┐
│   用户浏览器 │
└──────┬──────┘
       │
       ▼
┌─────────────────┐
│   Nginx         │  端口：7788/7789
│   (反向代理)    │
└──────┬──────────┘
       │
       ▼
┌─────────────────┐      ┌─────────────────┐
│  Node.js 前端   │      │  Node.js 后端   │
│  (静态文件)     │      │  (Express)      │
└─────────────────┘      └────────┬────────┘
                                  │
                                  ▼
                          ┌─────────────────┐
                          │   OceanBase     │
                          │   (MySQL 协议)  │
                          └─────────────────┘
                                  
                          ┌─────────────────┐
                          │  DataWorks      │
                          │  (MaxCompute)   │
                          └─────────────────┘
```

### 5.2 技术栈

| 层级 | 技术 | 说明 |
|------|------|------|
| **前端** | HTML + JavaScript + CSS | 轻量级前端，无需构建 |
| **后端** | Node.js + Express | 高性能 API 服务 |
| **数据库** | OceanBase | 分布式关系数据库 |
| **数据仓库** | DataWorks/MaxCompute | 阿里云大数据平台 |
| **部署** | Docker + Nginx | 容器化部署 |

### 5.3 数据源说明

**OceanBase（主数据源）**
- 用途：订单数据、商品数据、用户数据
- 协议：MySQL
- 特点：高可用、强一致

**DataWorks/MaxCompute（备选数据源）**
- 用途：搜索日志、行为数据
- 协议：HTTP API
- 特点：大数据量、离线分析

---

## 6. 系统配置

### 6.1 环境变量配置

创建 `backend/.env` 文件：

```bash
# OceanBase 数据库配置
DB_TYPE=oceanbase
DB_HOST=t5e434t9rgh4w.cn-hangzhou.oceanbase.aliyuncs.com
DB_PORT=3306
DB_USER=jxpt_query
DB_PASSWORD=your_password
DB_DATABASE=lianhua_b2c
DB_CONNECTION_LIMIT=50

# DataWorks/MaxCompute 配置
DATAWORKS_ENDPOINT=dataworks.cn-hangzhou.dataworks.aliyuncs.com
DATAWORKS_REGION=cn-hangzhou
DATAWORKS_PROJECT_ID=你的项目 ID
DATAWORKS_API_KEY=你的 AccessKeyId
DATAWORKS_API_SECRET=你的 AccessKeySecret

# 服务配置
PORT=4000
NODE_ENV=production

# 数据模式
USE_MOCK_DATA=false

# 导出配置
EXPORT_MAX_RECORDS=50000
EXPORT_RETENTION_DAYS=1
```

### 6.2 Docker 配置

**生产环境**（端口 7788）：
```bash
docker run -d \
  --name jingxuan-frontend \
  -p 7788:80 \
  -v /path/to/index.html:/usr/share/nginx/html/index.html \
  -v /path/to/docker/nginx/nginx.conf:/etc/nginx/nginx.conf \
  nginx:alpine
```

**开发环境**（端口 7789）：
```bash
docker run -d \
  --name jingxuan-dev-frontend \
  -p 7789:80 \
  -v /path/to/index.html:/usr/share/nginx/html/index.html \
  nginx:alpine
```

### 6.3 Nginx 缓存配置

```nginx
location / {
    try_files $uri $uri/ /index.html;
    
    # HTML 文件不缓存
    add_header Cache-Control "no-cache, no-store, must-revalidate";
    add_header Pragma "no-cache";
    add_header Expires "0";
}

# 静态资源长期缓存
location ~* \.(jpg|jpeg|png|gif|ico|css|js|woff|woff2|ttf|svg|eot)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}
```

---

## 7. 常见问题

### 7.1 查询类问题

**Q1：查询结果为空？**
- 检查日期范围是否正确
- 确认筛选条件是否过于严格
- 查看数据库是否有对应数据

**Q2：查询速度慢？**
- 第一次查询需要建立数据库连接（约 5-10 秒）
- 数据量大时会增加查询时间
- 建议缩小日期范围或使用更精确的筛选条件

**Q3：显示"数据库连接失败"？**
- 检查网络连接
- 确认数据库配置正确
- 联系管理员检查数据库状态

### 7.2 导出类问题

**Q4：导出任务失败？**
- 检查查询数据量是否超过 50,000 条
- 查看浏览器控制台错误信息
- 联系技术人员查看后端日志

**Q5：导出文件在哪里？**
- 导出文件存储在服务器 `backend/exports/` 目录
- 通过"📋 导出任务"按钮下载
- 文件保留 1 天，及时下载

**Q6：如何重复下载导出文件？**
- 点击"📋 导出任务"
- 找到已完成的导出任务
- 点击"⬇️ 下载"按钮

### 7.3 系统类问题

**Q7：页面显示不正常？**
- 按 `Cmd + Shift + R`（Mac）或 `Ctrl + Shift + R`（Windows）强制刷新
- 清除浏览器缓存
- 检查浏览器版本（建议使用 Chrome、Edge 最新版）

**Q8：点击导航地址变成 #？**
- 这是 HTML 文件被缓存导致
- 强制刷新浏览器（`Cmd + Shift + R`）
- 系统已配置 HTML 不缓存，下次访问会自动解决

**Q9：开发环境和生产环境的区别？**
- 开发环境：端口 7789，用于测试新功能
- 生产环境：端口 7788，正式使用环境
- 两个环境数据库相同（都是只读）

---

## 8. 版本历史

### v2.0（2026-02-27）
- ✅ 新增搜索关键词查询报表
- ✅ 修复商品渗透率导航切换问题
- ✅ 修复 showReport 函数缺少报表显示逻辑
- ✅ 彻底移除模拟数据模式
- ✅ 优化 Nginx 缓存配置（HTML 不缓存）
- ✅ 更新前端资源版本号机制

### v1.5（2026-02-23）
- ✅ 商品渗透率报表增加商品条码/编码筛选
- ✅ 优化查询性能
- ✅ 改进导出功能

### v1.4（2026-02-22）
- ✅ 新增社群拉新报表
- ✅ 新增商城用户下单报表
- ✅ 新增助力活动查询报表

### v1.3（2026-02-21）
- ✅ 新增免运活动查询报表
- ✅ 新增优惠券领用核销报表
- ✅ 优化导出任务管理

### v1.2（2026-02-20）
- ✅ 新增商品渗透率报表
- ✅ 支持多数据源（OceanBase + DataWorks）
- ✅ 改进分页性能

### v1.1（2026-02-19）
- ✅ 新增订单明细导出
- ✅ 优化筛选器交互
- ✅ 添加快捷日期选项

### v1.0（2026-02-15）
- ✅ 初始版本发布
- ✅ 支持订单查询报表
- ✅ 支持订单汇总/明细导出
- ✅ Docker 容器化部署

---

## 附录

### A. 联系支持

- **技术支持**：请联系 IT 部门
- **业务问题**：请联系运营部负责人
- **Bug 反馈**：请提供详细复现步骤和截图

### B. 相关文档

- [API 接口文档](./API 接口文档.md)
- [报表 SQL 说明](./报表 SQL 说明.md)
- [数据库表结构](./数据库表结构.md)
- [部署指南](./部署指南.md)

### C. 术语表

| 术语 | 说明 |
|------|------|
| OceanBase | 阿里云分布式关系数据库 |
| DataWorks | 阿里云大数据开发平台 |
| MaxCompute | 阿里云大数据计算服务 |
| 渗透率 | 购买商品的用户数占总用户数的比例 |
| 核销 | 优惠券的实际使用 |

---

**文档版本**：v2.0  
**最后更新**：2026 年 2 月 27 日  
**版权所有**：鲸选部门
